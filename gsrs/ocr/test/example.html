<html>
  <head>
     <script src="../node_modules/tesseract.js/dist/tesseract.min.js"></script>
  </head>
  <body>
    <div><h2>Peptide OCR Parser - Demo Version 4</h2></div>
    <div>This uses tessereact in a local browser-only way to try to detect amino acid sequences.</div>
    <div>
    <input type="file" id="uploader">
    </div>
    <script>
      function test1(f){
      const worker = Tesseract.createWorker({
  logger: m => console.log(m), // Add logger here
});

(async () => {
  await worker.load();
  await worker.loadLanguage('eng');
  await worker.initialize('eng');
  await worker.setParameters({
    tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ '
  });
  const { data: { text } } = await worker.recognize(f);
  console.log(text);
  document.getElementById("out").value=text;
  await worker.terminate();
})();
      }
      
      const recognize = async ({ target: { files }  }) => {
         var reader = new FileReader();
         let imageFile=files[0];
      reader.readAsDataURL(imageFile);
      reader.onloadend = function (e) {
        var myImage = new Image(); // Creates image object
        myImage.src = e.target.result; // Assigns converted image to image object
        myImage.onload = function(ev) {
          var myCanvas = document.getElementById("myCanvas"); // Creates a canvas object
          var myContext = myCanvas.getContext("2d"); // Creates a contect object
          myCanvas.width = myImage.width; // Assigns image's width to canvas
          myCanvas.height = myImage.height; // Assigns image's height to canvas
          myContext.drawImage(myImage,0,0); // Draws the image on canvas
          let imgData = myCanvas.toDataURL("image/jpeg",0.75); // Assigns image base64 string in jpeg format to a variable
        }
      }
        test1(files[0]);
        
      }
      const elm = document.getElementById('uploader');
      elm.addEventListener('change', recognize);
    </script>
    <div>
      <canvas id= "myCanvas" width="1000" height="700"></canvas>
    </div>
    <div>
      Results
    </div>
    <div>
    <textarea id="out"></textarea>
    </div>
  </body>
</html>
